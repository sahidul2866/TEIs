<div class="equation-editor-container">
  <!-- Try It! Header -->
  <div class="try-it-header">
    <span class="location-pin">ğŸ“</span>
    <span class="try-it-text">Try It!</span>
  </div>

  <!-- Instructions -->
  <div class="instructions">
    <p>{{ question.instruction }}</p>
    <ol class="instruction-list">
      <li>Select numbers and symbols to build an equation.</li>
      <li>Fill in dotted boxes with numbers as they appear.</li>
      <li>Use the Undo, Redo, and Delete buttons to fix mistakes.</li>
    </ol>
    <p class="example-text">Show 25 as an exponent using the Equation Editor.</p>
  </div>

  <!-- Main equation input area -->
  <div class="equation-input-section">
    <div class="equation-display">
      <input 
        #equationInput
        type="text"
        [(ngModel)]="currentEquation"
        (input)="onDirectInput($event)"
        (click)="onCursorChange($event)"
        (keyup)="onCursorChange($event)"
        (keydown)="onKeyDown($event)"
        (focus)="onInputFocus()"
        (blur)="onInputBlur()"
        class="equation-input"
        placeholder="Enter equation..."
        [attr.aria-label]="'Equation input field'"
        spellcheck="false"
        autocomplete="off">
    </div>

    <!-- Action buttons row -->
    <div class="action-buttons">
      <button class="action-btn" (click)="undoLastAction()" [disabled]="!canUndo()" title="Undo">
        <span class="btn-icon">â†¶</span>
      </button>
      <button class="action-btn" (click)="redoLastAction()" [disabled]="!canRedo()" title="Redo">
        <span class="btn-icon">â†·</span>
      </button>
      <button class="action-btn" (click)="backspace()" title="Delete">
        <span class="btn-icon">âŒ«</span>
      </button>
      <button class="action-btn" (click)="clearEquation()" title="Clear All">
        <span class="btn-icon">ğŸ—‘</span>
      </button>
      <button class="action-btn" (click)="insertSymbol('(')" title="Open Parenthesis">
        <span class="btn-text">(</span>
      </button>
      <button class="action-btn" (click)="insertSymbol(')')" title="Close Parenthesis">
        <span class="btn-text">)</span>
      </button>
    </div>

    <!-- Symbol palette -->
    <div class="symbol-palette">
      <!-- Number buttons -->
      <div class="number-section">
        <button 
          *ngFor="let num of getNumberButtons()" 
          class="symbol-btn number-btn"
          (click)="insertNumber(num)"
          [title]="'Insert ' + num">
          {{ num }}
        </button>
      </div>

      <!-- Operator buttons -->
      <div class="operator-section">
        <button 
          *ngFor="let op of operators" 
          class="symbol-btn operator-btn"
          (click)="insertOperator(op)"
          [title]="getOperatorName(op)">
          {{ op }}
        </button>
      </div>

      <!-- Special symbols -->
      <div class="special-section">
        <button class="symbol-btn special-btn" (click)="insertSymbol('xÂ²')" title="x squared">
          xÂ²
        </button>
        <button class="symbol-btn special-btn" (click)="insertSymbol('âˆš')" title="Square root">
          âˆš
        </button>
        <button class="symbol-btn special-btn" (click)="insertSymbol('Ï€')" title="Pi">
          Ï€
        </button>
        <button class="symbol-btn special-btn" (click)="insertSymbol('âˆ')" title="Infinity">
          âˆ
        </button>
      </div>
    </div>
  </div>
</div>